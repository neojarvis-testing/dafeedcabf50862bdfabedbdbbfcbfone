import { HttpRequest } from "@smithy/protocol-http";
export function addChecksumHeadersMiddleware(options) {
    return (next) => async (args) => {
        const request = args.request;
        if (HttpRequest.isInstance(request)) {
            let headers = request.headers;
            const body = request.body;
            if (body) {
                const [contentHash, treeHash] = await options.bodyChecksumGenerator(request, options);
                for (const [headerName, hash] of [
                    ["x-amz-content-sha256", contentHash],
                    ["x-amz-sha256-tree-hash", treeHash],
                ]) {
                    if (!(headerName in headers) && hash) {
                        headers = {
                            ...headers,
                            [headerName]: hash,
                        };
                    }
                }
                request.headers = headers;
            }
        }
        return next({
            ...args,
            request,
        });
    };
}
export const addChecksumHeadersMiddlewareOptions = {
    step: "build",
    tags: ["SET_CHECKSUM_HEADERS"],
    name: "addChecksumHeadersMiddleware",
    override: true,
};
