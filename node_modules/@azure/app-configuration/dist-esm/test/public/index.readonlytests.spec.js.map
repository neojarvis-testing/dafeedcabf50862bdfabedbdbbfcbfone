{"version":3,"file":"index.readonlytests.spec.js","sourceRoot":"","sources":["../../../test/public/index.readonlytests.spec.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { Recorder, isPlaybackMode } from \"@azure-tools/test-recorder\";\nimport {\n  assertThrowsAbortError,\n  assertThrowsRestError,\n  createAppConfigurationClientForTests,\n  deleteKeyCompletely,\n  startRecorder,\n} from \"./utils/testHelpers\";\nimport { AppConfigurationClient } from \"../../src\";\nimport { Context } from \"mocha\";\nimport { assert } from \"chai\";\n\ndescribe(\"AppConfigurationClient (set|clear)ReadOnly\", () => {\n  let client: AppConfigurationClient;\n  let recorder: Recorder;\n  const testConfigSetting = {\n    key: \"\",\n    value: \"world\",\n    label: \"some label\",\n  };\n\n  beforeEach(async function (this: Context) {\n    recorder = await startRecorder(this);\n    testConfigSetting.key = recorder.variable(\n      \"readOnlyTests\",\n      `readOnlyTests${Math.floor(Math.random() * 1000)}`,\n    );\n    client = createAppConfigurationClientForTests(recorder.configureClientOptions({}));\n    // before it's set to read only we can set it all we want\n    await client.setConfigurationSetting(testConfigSetting);\n  });\n\n  afterEach(async function () {\n    await deleteKeyCompletely([testConfigSetting.key], client);\n    await recorder.stop();\n  });\n\n  it(\"basic\", async function () {\n    let storedSetting = await client.getConfigurationSetting({\n      key: testConfigSetting.key,\n      label: testConfigSetting.label,\n    });\n    assert.ok(!storedSetting.isReadOnly);\n\n    await client.setReadOnly(testConfigSetting, true);\n\n    storedSetting = await client.getConfigurationSetting({\n      key: testConfigSetting.key,\n      label: testConfigSetting.label,\n    });\n    assert.ok(storedSetting.isReadOnly);\n\n    // any modification related methods throw exceptions\n    await assertThrowsRestError(\n      () => client.setConfigurationSetting(testConfigSetting),\n      409,\n      \"Set should fail because the setting is read-only\",\n    );\n    await assertThrowsRestError(\n      () =>\n        client.deleteConfigurationSetting({\n          key: testConfigSetting.key,\n          label: testConfigSetting.label,\n        }),\n      409,\n      \"Delete should fail because the setting is read-only\",\n    );\n  });\n\n  // Skipping all \"accepts operation options flaky tests\" https://github.com/Azure/azure-sdk-for-js/issues/26447\n  it.skip(\"accepts  operation options\", async function () {\n    // Recorder checks for the recording and complains before core-rest-pipeline could throw the AbortError (Recorder v2 should help here)\n    // eslint-disable-next-line @typescript-eslint/no-invalid-this\n    if (isPlaybackMode()) this.skip();\n    await client.getConfigurationSetting({\n      key: testConfigSetting.key,\n      label: testConfigSetting.label,\n    });\n\n    await assertThrowsAbortError(async () => {\n      await client.setReadOnly(testConfigSetting, true, { requestOptions: { timeout: 1 } });\n    });\n    await assertThrowsAbortError(async () => {\n      await client.setReadOnly(testConfigSetting, false, { requestOptions: { timeout: 1 } });\n    });\n  });\n});\n"]}